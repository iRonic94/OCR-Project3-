<!DOCTYPE html>
<html lang="fr">

<body>

    <head>
        <meta charset="UTF-8">
        <title>Sophie Bluel - Interior Designer</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=Work+Sans&display=swap"
            rel="stylesheet">
        <meta name="description" content="">
        <link rel="stylesheet" href="./assets/style.css">
        <script>
            function executeLogin() {
                const btnSubmit = document.getElementById("submit");
                btnSubmit.addEventListener("click", async (event) => {
                    //adding prevent default to prevent refreshing the page when clicking the login 
                    event.preventDefault();
                    var emailField = document.getElementById('email').value
                    var pass = document.getElementById('password').value
                    try {
                        var response = await fetch("http://localhost:5678/api/users/login", {
                            method: "POST",
                            //sending to the server an json file
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({
                                email: emailField,
                                password: pass
                            })
                        });
                        //checking the statuses
                        var status200 = document.getElementById("status-200");
                        var status404 = document.getElementById("status-401");
                        var status401 = document.getElementById("status-404");
                        //resetting token when is not logged in
                        localStorage.setItem("token", "");
                        if (response.status == 200) {
                            var data = await response.json();
                            //setting the token when is logged in
                            localStorage.setItem("token", data.token);
                            //redirect to the index
                            window.location.href = "index.html";
                        } else if (response.status == 401) {
                            status401.style.display = 'block';
                            status404.style.display = 'none';
                        } else if (response.status == 404) {
                            status401.style.display = 'none';
                            status404.style.display = 'block';
                        }
                    } catch (error) {
                        console.error("Failed to connect to the server", error);
                    }
                })
            }
            document.addEventListener("DOMContentLoaded", () => {
                executeLogin();
            });
        </script>
    </head>
    <header>
        <h1>Sophie Bluel <span>Interior Designer</span></h1>
        <nav>
            <ul>
                <li><a href="index.html">projects</a></li>
                <li><a href="#">contact</a></li>
                <li><a href="#">login</a></li>
                <li><img src="./assets/icons/instagram.png" alt="Instagram"></li>
            </ul>
        </nav>
    </header>
    <main>
        <section id="login">

            <form id="login-form" method="post">
                <label>email:</label>
                <input type="text" id="email" />
                <label>PASS:</label>
                <input type="password" id="password" />
                <button type="submit" value="login" id="submit">Login</button>
            </form>
            <!-- <div id="status-200" style="display:none"><span>Login successfully!</span></div> -->
            <div id="status-401" style="display:none"><span>Not Authorized!</span></div>
            <div id="status-404" style="display:none"><span>User not found!</span></div>
        </section>
    </main>

    <footer>
        <nav>
            <ul>
                <li>Legal Notice</li>
            </ul>
        </nav>
    </footer>
</body>

</html>